name: API Docs Integration

on:
  push:
    branches:
      - docs/#44

jobs:
  document:
    runs-on: ubuntu-latest
    steps:

      # ÌîÑÎ°úÏ†ùÌä∏ ÏΩîÎìúÎ•º Í∞ÄÏ†∏ÏòµÎãàÎã§.
      - name: Checkout Code 
        uses: actions/checkout@v3
        with:
          ref: 'docs/#44'

      # - name: move to docs directory
      #   run: |
      #     cd ./noti-service/docs

      - name: redoc-cli-github-action
        uses: seeebiii/redoc-cli-github-action@v9
        with:
          args: 'bundle ./noti-service/docs/noti.json --output ./noti-service/docs/api-docs.html --ext html'

      # - name: Rename Yaml Title & Desc
      #   run: |
      #     cat ./noti-service/docs/noti.yaml
      #     yq -i '.info.title = "PetStore Backend API Document for FrontEnd"' ./noti-service/docs/noti.yaml
      #     yq -i '.info.description = "Please contact Petstore backend if there are any issues with API"' ./noti-service/docs/noti.yaml

      # - name: redoc-cli-github-action
      #   uses: seeebiii/redoc-cli-github-action@v9
      #   with:
      #     args: 'build-docs ./noti-serivce/docs/noti.yaml --output ./noti-serivce/docs/api-docs.html'

      - name: save build result to tmp dir
        run: |
          mkdir -p docs
          mv ./noti-service/docs/api-docs.html ./docs
        

      - name: Commit and push build artifacts
        run: |        
          git config --global user.name "WaitherTeam"
          git add .
          git commit -m "üìùdocs : Generate API Docs"
          git push ${{ secrets.REPOSITORY_URL }} HEAD:apiDocs
